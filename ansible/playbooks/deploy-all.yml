---
# Playbook MASTER: DÃ©ploiement complet du rÃ©seau Hyperledger Fabric
# Usage: ansible-playbook -i inventory/hosts.yml playbooks/deploy-all.yml

- name: "===== PHASE 1: Installation des PrÃ©requis ====="
  import_playbook: 00-prerequisites.yml

- name: "===== PHASE 2: Installation de Docker ====="
  import_playbook: 01-install-docker.yml

- name: "===== PHASE 3: Configuration du Pare-feu ====="
  import_playbook: 02-configure-firewall.yml

- name: "===== PHASE 4: Copie du MatÃ©riel Cryptographique ====="
  import_playbook: 03-copy-crypto-material.yml

- name: "===== PHASE 5: DÃ©ploiement des Conteneurs ====="
  import_playbook: 04-deploy-containers.yml

- name: "===== PHASE 6: CrÃ©ation du Channel ====="
  import_playbook: 05-create-channel.yml

- name: "===== PHASE 7: DÃ©ploiement du Chaincode ====="
  import_playbook: 06-deploy-chaincode.yml

- name: "===== PHASE 8: DÃ©ploiement de l'API REST ====="
  import_playbook: 07-deploy-api.yml

- name: "===== DÃ‰PLOIEMENT TERMINÃ‰ ====="
  hosts: localhost
  connection: local
  gather_facts: no
  
  tasks:
    - name: "ğŸ‰ RÃ©sumÃ© Final du DÃ©ploiement"
      debug:
        msg:
          - "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          - "          DÃ‰PLOIEMENT HYPERLEDGER FABRIC RÃ‰USSI !          "
          - "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          - ""
          - "ğŸ“¦ RÃ©seau DÃ©ployÃ©:"
          - "   â€¢ Orderer: {{ hostvars['vm4-orderer']['ansible_host'] }}:7050"
          - "   â€¢ Peer AFOR: {{ hostvars['vm1-afor']['ansible_host'] }}:7051"
          - "   â€¢ Peer CVGFR: {{ hostvars['vm2-cvgfr']['ansible_host'] }}:8051"
          - "   â€¢ Peer PREFET: {{ hostvars['vm3-prefet']['ansible_host'] }}:9051"
          - ""
          - "ğŸ”— Channel: contrat-agraire"
          - "ğŸ“œ Chaincode: contrat-agraire-cc v4.0"
          - "ğŸŒ API REST: http://{{ hostvars['vm1-afor']['ansible_host'] }}:3000"
          - "ğŸ“š Swagger: http://{{ hostvars['vm1-afor']['ansible_host'] }}:3000/api-docs"
          - ""
          - "ğŸ” Authentification Keycloak:"
          - "   â€¢ URL: https://auth.digifor2.afor-ci.app"
          - "   â€¢ Realm: digifor2"
          - "   â€¢ Client: iam-user-auth"
          - ""
          - "âœ… Toutes les phases terminÃ©es avec succÃ¨s!"
          - "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
